<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IG Feed Scheduler</title>
</head>

<body>
  <h2>IG Feed Scheduler</h2>

  <hr>

  <!-- FORM INPUT -->
  <h3>Tambah Jadwal</h3>

  <input id="caption" placeholder="Caption..." />
  <input id="date" type="date" />
  <input id="time" type="time" />

  <button onclick="addSchedule()">Tambah</button>

  <hr>

  <!-- LIST JADWAL -->
  <h3>Daftar Jadwal Posting</h3>

  <ul id="scheduleList"></ul>

  <button onclick="deleteAllSchedules()">Hapus Semua</button>

  <!-- FIREBASE SCRIPT -->
  <script type="module">
    // Firebase Core
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";

    // Firestore SDK
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    // CONFIG PROJECT KAMU
    const firebaseConfig = {
      apiKey: "AIzaSyAfZq2FNtrNId5j32ogtSc4AGsgiIUVwtM",
      authDomain: "ig-feed-scheduler.firebaseapp.com",
      projectId: "ig-feed-scheduler",
      storageBucket: "ig-feed-scheduler.firebasestorage.app",
      messagingSenderId: "374047074631",
      appId: "1:374047074631:web:cc2c605fcfb8fcf9cac462"
    };

    // INIT
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ELEMENT LIST
    const scheduleList = document.getElementById("scheduleList");

    // LOAD DATA SAAT BUKA WEB
    async function loadSchedules() {
      scheduleList.innerHTML = "";

      const snapshot = await getDocs(collection(db, "schedules"));

      snapshot.forEach((docItem) => {
        const data = docItem.data();

        const li = document.createElement("li");
        li.textContent = `${data.caption} â€” ${data.date} ${data.time}`;
        scheduleList.appendChild(li);
      });
    }

    // ADD DATA
    window.addSchedule = async function () {
      const caption = document.getElementById("caption").value;
      const date = document.getElementById("date").value;
      const time = document.getElementById("time").value;

      if (!caption || !date || !time) {
        alert("Isi semua dulu ya!");
        return;
      }

      await addDoc(collection(db, "schedules"), {
        caption,
        date,
        time
      });

      alert("Jadwal tersimpan!");

      loadSchedules();
    };

    // DELETE ALL
    window.deleteAllSchedules = async function () {
      const snapshot = await getDocs(collection(db, "schedules"));

      snapshot.forEach(async (item) => {
        await deleteDoc(doc(db, "schedules", item.id));
      });

      alert("Semua jadwal dihapus!");
      loadSchedules();
    };

    // AUTO RUN
    loadSchedules();
  </script>
</body>
</html>
